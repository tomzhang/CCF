

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <title>Issuing Commands &#8212; CCF  documentation</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="https://unpkg.com/mermaid@8.4.8/dist/mermaid.min.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="RPC API" href="rpc_api.html" />
    <link rel="prev" title="Deploying an Application" href="deploy_app.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

    
    <a class="navbar-brand" href="../index.html">
      <img src="../_static/ccf.svg" class="logo" alt="logo">
    </a>
    
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar-menu" class="col-11 collapse navbar-collapse">
      <ul id="navbar-main-elements" class="navbar-nav mr-auto">
        
        
        <li class="nav-item ">
            <a class="nav-link" href="../introduction.html">Introduction</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../concepts.html">Concepts</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../quickstart/index.html">Start Here</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../members/index.html">Governance</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../developers/index.html">Building Apps</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../operators/index.html">Operations</a>
        </li>
        
        <li class="nav-item active">
            <a class="nav-link" href="index.html">Using Apps</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../glossary.html">Glossary</a>
        </li>
        
        
      </ul>

      <ul class="navbar-nav">
        
          <li class="nav-item">
            <a class="nav-link" href="https://github.com/Microsoft/CCF" target="_blank" rel="noopener">
              <span><i class="fab fa-github-square"></i></span>
            </a>
          </li>
        
        
      </ul>
    </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
          <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>


<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">

  <div class="bd-toc-item active">
  

  <ul class="nav bd-sidenav">
      
      
      
      
      
      
      
      
      
      
      
      
      
      
        
          
              <li class="">
                  <a href="deploy_app.html">Deploying an Application</a>
              </li>
          
        
          
              <li class="active">
                  <a href="">Issuing Commands</a>
              </li>
          
        
          
              <li class="">
                  <a href="rpc_api.html">RPC API</a>
              </li>
          
        
      
      
      
      
    </ul>

    
      <ul>
        <li>
          <a href="issue_commands.html" class="badge">v0.10</a>
        </li>
      </ul>
      <ul>
        <li>
          <a href="../../master/users/issue_commands.html" class="badge">master</a>
        </li>
      </ul>
    

</nav>
          </div>
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
              
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#signing" class="nav-link">Signing</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#python-client" class="nav-link">Python Client</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#checking-for-commit" class="nav-link">Checking for Commit</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#transaction-receipts" class="nav-link">Transaction receipts</a>
        </li>
    
    </ul>
</nav>



<div class="tocsection editthispage">
    <a href="https://github.com/Microsoft/CCF/edit/master/doc/users/issue_commands.rst">
        <i class="fas fa-pencil-alt"></i> Edit this page
    </a>
</div>

              
          </div>
          

          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="section" id="issuing-commands">
<h1>Issuing Commands<a class="headerlink" href="#issuing-commands" title="Permalink to this headline">¶</a></h1>
<p>Clients communicate with CCF using HTTP requests.</p>
<p>These requests can be sent by standard tools. CCF’s test infrastructure uses <a class="reference external" href="https://requests.readthedocs.io/en/master/">Python Requests</a> by default, but can be switched to a <code class="docutils literal notranslate"><span class="pre">curl</span></code>-based client (printing each command to stdout) by running with environment variable <code class="docutils literal notranslate"><span class="pre">CURL_CLIENT</span></code> set.</p>
<p>For example, to record a message at a specific id with the <a class="reference internal" href="../developers/example.html#example-application"><span class="std std-ref">Example Application</span></a>, using curl:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cat request.json
<span class="o">{</span>
  <span class="s2">&quot;id&quot;</span>: <span class="m">42</span>,
  <span class="s2">&quot;msg&quot;</span>: <span class="s2">&quot;Hello There&quot;</span>
<span class="o">}</span>

$ curl https://&lt;ccf-node-address&gt;/users/LOG_record --cacert networkcert.pem --key user0_privk.pem --cert user0_cert.pem --data-binary @request.json -H <span class="s2">&quot;content-type: application/json&quot;</span> -i
HTTP/1.1 <span class="m">200</span> OK
content-length: <span class="m">5</span>
content-type: application/json
x-ccf-commit: <span class="m">23</span>
x-ccf-global-commit: <span class="m">22</span>
x-ccf-term: <span class="m">2</span>

<span class="nb">true</span>
</pre></div>
</div>
<p>The HTTP response some CCF commit information in the headers:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;x-ccf-commit&quot;</span></code> is the unique version at which the request was executed</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;x-ccf-global-commit&quot;</span></code> is the latest version agreed on by the network and forever committed to the ledger, at the time the request was executed, as seen by the contacted node</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;x-ccf-term&quot;</span></code> indicates the consensus term at which the request was executed</p></li>
</ul>
<p>The response body (the JSON value <code class="docutils literal notranslate"><span class="pre">true</span></code>) indicates that the request was executed successfully. For many RPCs this will be a JSON object with more details about the execution result.</p>
<div class="section" id="signing">
<h2>Signing<a class="headerlink" href="#signing" title="Permalink to this headline">¶</a></h2>
<p>In some situations CCF requires signed requests, for example for member votes. The signing scheme is compatible with the <a class="reference external" href="https://tools.ietf.org/html/draft-cavage-http-signatures-12">IETF HTTP Signatures draft RFC</a>. We provide a wrapper script (<code class="docutils literal notranslate"><span class="pre">scurl.sh</span></code>) around curl to submit signed requests from the command line.</p>
<p>These commands can also be signed and transmitted by external libraries. For example, the CCF test infrastructure uses <a class="reference external" href="https://pypi.org/project/requests-http-signature/">an auth plugin</a> for <a class="reference external" href="https://requests.readthedocs.io/en/master/">Python Requests</a>.</p>
</div>
<div class="section" id="python-client">
<h2>Python Client<a class="headerlink" href="#python-client" title="Permalink to this headline">¶</a></h2>
<p>Available as part of CCF Python infra: <a class="reference external" href="https://github.com/microsoft/CCF/blob/master/tests/infra/clients.py">https://github.com/microsoft/CCF/blob/master/tests/infra/clients.py</a>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">Checker</span></code> class in <a class="reference external" href="https://github.com/microsoft/CCF/blob/master/tests/infra/ccf.py">ccf.py</a> can be used as a wrapper to wait for requests to be committed.</p>
</div>
<div class="section" id="checking-for-commit">
<h2>Checking for Commit<a class="headerlink" href="#checking-for-commit" title="Permalink to this headline">¶</a></h2>
<p>Because of the decentralised nature of CCF, a request is committed to the ledger only once a number of nodes have agreed on that request.</p>
<p>To guarantee that their request is successfully committed to the ledger, a user should issue a <code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">/tx</span></code> request, specifying the version received in the response. This version is constructed from a view (also called term in some places) and a sequence number (or commit index).</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ curl -X GET <span class="s2">&quot;https://&lt;ccf-node-address&gt;/users/tx?view=2&amp;seqno=18&quot;</span> --cacert networkcert.pem --key user0_privk.pem --cert user0_cert.pem -i
HTTP/1.1 <span class="m">200</span> OK
content-length: <span class="m">23</span>
content-type: application/json
x-ccf-commit: <span class="m">42</span>
x-ccf-global-commit: <span class="m">40</span>
x-ccf-term: <span class="m">5</span>

<span class="o">{</span><span class="s2">&quot;status&quot;</span>:<span class="s2">&quot;COMMITTED&quot;</span><span class="o">}</span>
</pre></div>
</div>
<p>This example queries the status of transaction ID 2.18 (constructed from view 2 and sequence number 18). The response indicates this was successfully committed. The headers also show that the service has since made progress with other requests, and global commit index has continued to increase.</p>
<p>The possible statuses are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">UNKNOWN</span></code> - this node has not received a transaction with the given ID</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PENDING</span></code> - this node has received a transaction with the given ID, but does not yet know if the transaction has been committed</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">COMMITTED</span></code> - this node knows that this transaction is committed, it is an irrevocable and durable part of the service’s transaction history</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">INVALID</span></code> - this node knows that the given transaction cannot be committed. This occurs when the view changes, and some pending transactions may be lost and must be resubmitted, but also applies to IDs which are known to be impossible given the current globally committed IDs</p></li>
</ul>
<p>On a given node, the possible transitions between states are described in the following diagram:</p>
<script>mermaid.initialize({startOnLoad:true});</script><div class="mermaid">
            stateDiagram
    Unknown --&gt; Pending
    Pending --&gt; Committed
    Pending --&gt; Invalid
        </div><p>It is possible that intermediate states are not visible (eg - a transition from Unknown to Committed may never publically show a Pending result). Nodes may disagree on the current state due to communication delays, but will never disagree on transitions (in other words, they may believe a Committed transaction is still Unknown or Pending, but will never report it as Invalid).</p>
<p>Note that transaction IDs are uniquely assigned by the service - once a request has been assigned an ID, this ID will never be associated with a different write transaction. In normal operation, the next requests will be given versions 2.19, then 2.20, and so on, and after a short delay 2.18 will be committed. If requests are submitted in parallel, they will be applied in a consistent order indicated by their assigned versions. If the network is unable to reach consensus, it will trigger a leadership election which increments the view. In this case the user’s next request may be given a version 3.16, followed by 3.17, then 3.18. The sequence number is reused, but in a different view; the service knows that 2.18 can never be assigned, so it can report this as an invalid ID. Read-only transactions are an exception - they do not get a unique transaction ID but instead return the ID of the last write transaction whose state they may have read.</p>
</div>
<div class="section" id="transaction-receipts">
<h2>Transaction receipts<a class="headerlink" href="#transaction-receipts" title="Permalink to this headline">¶</a></h2>
<p>Once a transaction has been committed, it is possible to get a receipt for it. That receipt can later be checked against either a CCF service, or offline against the ledger, to prove that the transaction did happen at a particular commit.</p>
<p>To obtain a receipt, a user needs to issue a <code class="docutils literal notranslate"><span class="pre">getReceipt</span></code> RPC for a particular commit:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ curl -X GET <span class="s2">&quot;https://&lt;ccf-node-address&gt;/users/getReceipt?commit=23&quot;</span> --cacert networkcert.pem --key user0_privk.pem --cert user0_cert.pem
<span class="o">{</span>
  <span class="s2">&quot;receipt&quot;</span>: <span class="o">[</span> ... <span class="o">]</span>,
<span class="o">}</span>
</pre></div>
</div>
<p>Receipts can be verified with the <code class="docutils literal notranslate"><span class="pre">verifyReceipt</span></code> RPC:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cat verify_receipt.json
<span class="o">{</span>
  <span class="s2">&quot;receipt&quot;</span>: <span class="o">[</span> ... <span class="o">]</span>
<span class="o">}</span>

$ curl https://&lt;ccf-node-address&gt;/users/verifyReceipt --cacert networkcert.pem --key user0_privk.pem --cert user0_cert.pem --data-binary @verify_receipt.json
<span class="o">{</span>
  <span class="s2">&quot;valid&quot;</span>: true,
<span class="o">}</span>
</pre></div>
</div>
</div>
</div>


              </div>
              
              
              <div class='prev-next-bottom'>
                
    <a class='left-prev' id="prev-link" href="deploy_app.html" title="previous page">Deploying an Application</a>
    <a class='right-next' id="next-link" href="rpc_api.html" title="next page">RPC API</a>

              </div>
              
          </main>
          

      </div>
    </div>

    <script src="../_static/js/index.js"></script>
    <footer class="footer mt-5 mt-md-0">
  <div class="container">
    <p>
          &copy; Copyright 2018, Microsoft Research.<br/>
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.0.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>